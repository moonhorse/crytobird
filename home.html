<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home</title>
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <script type="text/javascript" src="js/nebPay.js"></script>
    <script type="text/javascript">
      var NebPay = require("nebpay");
      var nebPay = new NebPay();
      var serialNumber;
      var callbackUrl = NebPay.config.testnetUrl;
      var time_id;

      function listener(resp) {
        console.log("listener: " + JSON.stringify(resp))
        document.getElementById('result').value = JSON.stringify(resp)
      }

      //n1z9LrTVfckAsz9G5BRdnmHYPjmZzhR9nnz

      function onCallClick2() {
        var to = 'n1z9LrTVfckAsz9G5BRdnmHYPjmZzhR9nnz';
        var value = '0';
        var callFunction = 'balanceOf';
        var callArgs = '[]';
        serialNumber = nebPay.call(to, value, callFunction, callArgs, {
          callback:callbackUrl,
          listener: listener
        });
        console.log(serialNumber)
        time_id = setInterval(() => {
          onrefreshClick();
        }, 2000);
      }


      function onCallClick() {
        var to = 'n1wwj1tCFNPuUeEXvZogp3A4Da7BSc6HNiD';
        var value = '0.001';
        var callFunction = 'startToPlay';
        var callArgs = '[]';
        serialNumber = nebPay.call(to, value, callFunction, callArgs, {
          callback:callbackUrl,
          listener: listener
        });
        console.log(serialNumber)
        time_id = setInterval(() => {
          onrefreshClick();
        }, 2000);
      }


      function onrefreshClick() {
        console.log('onrefreshClick')
        nebPay.queryPayInfo(serialNumber,{callback: callbackUrl})   //search transaction result from server (result upload to server by app)
          .then(function (resp) {
            resp = JSON.parse(resp)
            if((resp.code === 0 && resp.data.status === 1)){
              clearInterval(time_id)
              var gameid = JSON.parse( resp.data.execute_result )
              window.location.href = 'floppybird.html?id='+gameid
            }
          })
          .catch(function (err) {
            console.log(err);
          });
      }


    </script>
</head>
<body>
    <div class="page-header">
  <h1>CryptoBird</h1>
</div>

<div class="container">
    <div class="text-center">
        <img src="assets/splash.png" class="img-polaroid">
    </div>
    <div class="text-center">This is CryptoBird Home</div>
    <div class="text-center">
        <button  class="btn btn-primary btn-large"  type="button" onClick="onCallClick();">Start Game</button>
    </div>
    <textarea id="result" readonly="readonly"></textarea>
</div>

</body>
</html>